-- Tasty Bytes - RAG Chatbot Using Cortex and Streamlit (inspired from)
-- https://quickstarts.snowflake.com/guide/tasty_bytes_rag_chatbot_using_cortex_and_streamlit/index.html
USE DATABASE test;
CREATE OR REPLACE SCHEMA test.rag;

-- create stage and load docs
CREATE FILE FORMAT csv_ff TYPE='csv';
CREATE STAGE s3load
    url='s3://sfquickstarts/tastybytes-cx/app/'
    file_format=csv_ff;
LIST @s3load;

-- create tables and load data
CREATE TABLE documents(
	RELATIVE_PATH VARCHAR(16777216),
	RAW_TEXT VARCHAR(16777216));
COPY INTO documents FROM @s3load/documents/;
SELECT * FROM documents;

CREATE TEMP TABLE vector_store_temp(
    SOURCE VARCHAR(6),
	SOURCE_DESC VARCHAR(16777216),
	FULL_TEXT VARCHAR(16777216),
	SIZE NUMBER(18,0),
	CHUNK VARCHAR(16777216),
	INPUT_TEXT VARCHAR(16777216),
	CHUNK_EMBEDDING ARRAY);
COPY INTO vector_store_temp FROM @s3load/vector_store/;

CREATE TABLE vector_store(
	SOURCE VARCHAR(6),
	SOURCE_DESC VARCHAR(16777216),
	FULL_TEXT VARCHAR(16777216),
	SIZE NUMBER(18,0),
	CHUNK VARCHAR(16777216),
	INPUT_TEXT VARCHAR(16777216),
	CHUNK_EMBEDDING VECTOR(FLOAT, 768))
AS SELECT source, source_desc, full_text, size, chunk, input_text,
    chunk_embedding::VECTOR(FLOAT, 768)
FROM vector_store_temp;
SELECT * FROM vector_store;

-- ask question ("Who is the CEO?")
SELECT input_text, source_desc,
    VECTOR_COSINE_SIMILARITY(chunk_embedding,
        SNOWFLAKE.CORTEX.EMBED_TEXT_768('e5-base-v2',
            ' User: Id like to know who the CEO of a specific company is. Could you please help me with that?
            Assistant: Of course! Could you please specify which company youre asking about? Ill do my best to provide you with the accurate and most recent information available.')) as dist
FROM vector_store
ORDER BY dist DESC
LIMIT 1;

SELECT SNOWFLAKE.CORTEX.COMPLETE(
    'mistral-7b', 
    'Answer this new customer question sent to our support agent at Tasty Bytes Food Truck Company. Use the background information and provided context taken from the most relevant corporate documents or previous support chat logs with other customers. Be concise and only answer the latest question. The question is in the chat. Chat: <chat> [{role: assistant, content: What question do you need assistance answering?}, {role: user, content: Who is the CEO?}] </chat>. Context: <context> { "chatLog": [ { "id": "1", "timestamp": "2023-04-15T17:22:51Z", "sender": "user", "message": "مرحبا! أريد الحصول على معلومات حول فتح فرع جديد لمتجر Tasty Bytes في القاهرة. هل يمكنك مساعدتي؟", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["franchise", "new", "Cairo"] } }, { "id": "2", "timestamp": "2023-04-15T17:25:12Z", "sender": "agent", "message": "Hello! Id be happy to help you with that. Were always excited about potential new franchises. I can provide you with some general information about the process. Would you like that in English, French, or Spanish?", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["language preference", "franchise process"] } }, { "id": "3", "timestamp": "2023-04-15T17:27:36Z", "sender": "user", "message": "ممكن تكون باللغة الإنجليزية. شكرًا!", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["language preference", "thanks"] } }, { "id": "4", "timestamp": "2023-04-15T17:30:02Z", "sender": "agent", "message": "Great! To start, you would need to fill out our franchise application form. Once we receive your application, it will be reviewed by our team. If approved, we will guide you through the next steps which include signing a franchise agreement, paying the initial franchise fee, and setting up your food truck. Does that sound good?", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["franchise application", "franchise agreement", "franchise fee"] } }, { "id": "5", "timestamp": "2023-04-15T17:32:21Z", "sender": "user", "message": "نعم، شكرًا! هل هناك أي تكاليف أخرى يجب أن أعرفها؟", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["additional costs"] } }, { "id": "6", "timestamp": "2023-04-15T17:35:45Z", "sender": "agent", "message": "Yes, in addition to the initial franchise fee, there are ongoing royalty fees and marketing fees. These are typically a percentage of your gross sales. The exact percentages can vary, but this will all be outlined in the franchise agreement. Would you like more information about these costs?", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["royalty fees", "marketing fees", "gross sales"] } }, { "id": "7", "timestamp": "2023-04-15T17:37:18Z", "sender": "user", "message": "نعم، شكرًا. سأحتاج إلى المزيد من التفاصيل حول ذلك. كم يمكن أن تكون التكاليف السنوية الإجمالية أحدث التقدير؟", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["annual costs", "estimate"] } }, { "id": "8", "timestamp": "2023-04-15T17:40:32Z", "sender": "agent", "message": "Im glad to provide more details. However, I should clarify that I cant provide an exact estimate for your annual costs without more specific information about your location, the type of truck youre interested in, and other factors. But I can tell you that our franchisees typically find that their royalty and marketing fees together amount to around 8-12% of their gross sales. Would you like to proceed with the application process?", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["royalty and marketing fees", "gross sales", "application process"] } }, { "id": "9", "timestamp": "2023-04-15T17:43:01Z", "sender": "user", "message": "نعم، أريد الاستمرار في عملية التقدم. كيف يمكنني الحصول على نموذج التقدم؟", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["application form", "process"] } }, { "id": "10", "timestamp": "2023-04-15T17:45:26Z", "sender": "agent", "message": "Great! You can find our franchise application form on our website under the Franchise Opportunities section. If you have any trouble finding it, please let me know and I can guide you through it. Once youve filled out the form, you can submit it online and our team will review it. Well be in touch with you within two weeks to let you know the status of your application. Does that sound good?", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["application form", "website", "franchise opportunities"] } }, { "id": "11", "timestamp": "2023-04-15T17:47:05Z", "sender": "user", "message": "نعم، شكرًا جزيلًا على مساعدتك! سأتمكن من العثور على النموذج على الموقع. هل يمكنني الاتصال بك في حالة وجود أي استفسارات أخرى؟", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["further questions", "contact"] } }, { "id": "12", "timestamp": "2023-04-15T17:48:50Z", "sender": "agent", "message": "Youre welcome! Im glad I could help. Yes, absolutely. If you have any further questions, please dont hesitate to reach out. Our customer support team is available 24/7 to assist you. You can contact us through this chat, email, or phone. Our contact information is also available on our website. Have a great day!", "context": { "location": "Cairo", "category": "Franchise Information", "tags": ["customer support", "contact information", "website"] } } ] } </context>. Background Info: <background_info> Who We Are: Tasty Bytes is a global food truck business with a presence in cities around the world. In every city, there is one food truck for each Brand that Tasty Bytes offers. Some of these trucks are owned and run by local franchise owners, while others are operated directly by Tasty Bytes corporate offices. Regardless of ownership, Tasty Bytes corporate provides support to all trucks to ensure they meet the companys quality and service standards. Food trucks operate in two shifts: a morning shift from 9 AM to 3 PM (9:00 to 15:00) and an evening shift from 5 PM to midnight (17:00 to 24:00). Trucks change locations in between these shifts. Our Values: Quality and Freshness: Tasty Bytes is committed to serving only the highest quality food, using fresh ingredients to ensure every bite is as delicious and satisfying as possible. This commitment extends across all food truck brands and menu items, ensuring consistency and excellence in every meal served. Customer Satisfaction and Engagement: Ensuring customer satisfaction is at the heart of everything Tasty Bytes does, from the development of diverse and inclusive menus to the functionality of their mobile app. They value feedback and strive to create a positive, engaging experience for customers across all touchpoints, fostering a loyal and happy community. Sustainability and Responsibility: Tasty Bytes operates with a strong commitment to sustainability and social responsibility, recognizing the importance of environmental stewardship and community support. This includes sustainable sourcing practices, eco-friendly packaging, waste reduction efforts, and active participation in community events and charity initiatives. Geographies We Support: Australia: Melbourne (Victoria), Sydney (New South Wales) Brazil: Rio de Janeiro, São Paulo Canada: Montreal (Quebec), Toronto (Ontario), Vancouver (British Columbia) Egypt: Cairo France: Nice, Paris Germany: Berlin, Hamburg, Munich India: Delhi, Mumbai Japan: Tokyo Poland: Krakow, Warsaw South Africa: Cape Town South Korea: Seoul Spain: Barcelona, Madrid Sweden: Stockholm United Kingdom: London, Manchester United States: Boston (Massachusetts), Denver (Colorado), New York City (New York), San Mateo (California), Seattle (Washington) Our Truck Brands and Menu Item Offerings: Better Off Bread (Sandwiches) : Hot Ham & Cheese, Italian, Pastrami, Bottled Water, Bottled Soda, Ice Tea Cheeky Greek (Greek Cuisine): Gyro Plate, The King Combo, Greek Salad, Bottled Water, Bottled Soda, Ice Tea Freezing Point (Frozen Desserts): Ice Cream Sandwich, Lemonade, Mango Sticky Rice, Popsicle, Sugar Cone,Two Scoop Bowl, Waffle Cone, Bottled Water, Bottled Soda, Ice Tea Guac n Roll (Mexican Cuisine): Chicken Burrito, Fish Burrito, Lean Burrito Bowl, Three Taco Combo Plate, Two Taco Combo Plate, Veggie Taco Bowl, Bottled Water, Bottled Soda, Ice Tea Kitakata Ramen Bar (Japanese Ramen): Creamy Chicken Ramen, Spicy Miso Vegetable Ramen, Tonkotsu Ramen, Bottled Water, Bottled Soda, Ice Tea Le Coin des Crêpes (French Crêpes): Breakfast Crepe, Chicken Pot Pie Crepe, Crepe Suzette, Bottled Water, Bottled Soda, Ice Tea Nanis Kitchen (Indian Cuisine): Combination Curry, Lean Chicken Tikka Masala, Tandoori Mixed Grill, Bottled Water, Bottled Soda, Ice Tea Not the Wurst Hot Dogs (Hot Dogs and Sausages): Chicago Dog, Coney Dog, New York Dog, Bottled Water, Bottled Soda, Ice Tea Peking Truck (Chinese Cuisine): Combo Fried Rice Combo Lo Mein Wonton Soup, Bottled Water, Bottled Soda, Ice Tea Plant Palace (Vegetarian and Vegan Options): Seitan Buffalo Wings, The Salad of All Salads, Veggie Burger, Bottled Water, Bottled Soda, Ice Tea Revenge of the Curds (Poutine and Canadian Cuisine): Mothers Favorite, The Classic, The Kitchen Sink, Bottled Water, Bottled Soda, Ice Tea Smoky BBQ (Barbecue and Grilled Meats): Fried Pickles, Pulled Pork Sandwich, Rack of Pork Ribs, Spring Mix Salad, Three Meat Plate,Two Meat Plate, Bottled Water, Bottled Soda, Ice Tea Tasty Tibs (Ethiopian Cuisine): Lean Beef Tibs, Lean Chicken Tibs, Veggie Combo, Bottled Water, Bottled Soda, Ice Tea The Mac Shack (Gourmet Macaroni and Cheese): Buffalo Mac & Cheese, Lobster Mac & Cheese, Standard Mac & Cheese, Bottled Water, Bottled Soda, Ice Tea The Mega Melt (Grilled Cheese Sandwiches): Miss Piggie, The Original, The Ranch, Bottled Water, Bottled Soda, Ice TeaOur Leadership Team: CEO (Chief Executive Officer): Crystal Frostbourne - Oversees the entire operation of the company and makes major corporate decisions. CFO (Chief Financial Officer): Sterling Snowfield - Responsible for managing the companys finances, including financial planning, management of financial risks, record-keeping, and financial reporting. CRO (Chief Risk Officer): Blizzard Wintergate - In charge of identifying, evaluating, and mitigating risks to the companys capital and earnings. CCO (Chief Compliance Officer): Icelyn Snowdrift - Ensures the company complies with external regulatory requirements and internal policies. Head of Franchisees: Frostine Snowshard - Oversees the development and management of franchise operations, ensuring brand consistency and supporting franchisee success across the network. Our Headquarters: With no official headquarters, Tasty Bytes embodies the modern digital age, operating in a flexible, dynamic environment. Grow your Career with Tasty Bytes: Our Careers page on our website is your gateway to exploring a diverse range of job opportunities, from the heart of our Trucks as dedicated Cooks to strategic roles within our Corporate team. Become a Tasty Bytes Franchisee: Opportunity: Were searching for passionate entrepreneurs who are ready to dive into the culinary world and drive their own Tasty Bytes food truck. Timeline: Embarking on your Tasty Bytes franchise journey is an exciting process that ensures we align on every front, typically taking between 12 to 18 months. Financials: Understanding the financial aspects of running a Tasty Bytes franchise is crucial. We encourage serious candidates to delve into the details by filling out the Contact Me form in the Franchise section of our website. Priority Locations: Tasty Bytes is prioritizing new Trucks in cities with over a half million residents. </background_info>.');
-- --> " The CEO of Tasty Bytes is Crystal Frostbourne."
